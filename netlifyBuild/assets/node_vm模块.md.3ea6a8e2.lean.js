import{_ as n,c as a,a as l,o}from"./app.580fb14e.js";var p="/assets/node_vm.3612dfd3.png";const A=JSON.parse('{"title":"NodeJs\u4E2D\u7684vm\u6A21\u5757\u8BE6\u89E3","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u4EC0\u4E48\u662Fvm\uFF1F","slug":"\u4EC0\u4E48\u662Fvm\uFF1F"},{"level":2,"title":"runInThisContext","slug":"runinthiscontext"},{"level":2,"title":"runInContext","slug":"runincontext"},{"level":2,"title":"\u6BD4\u8F83","slug":"\u6BD4\u8F83"},{"level":2,"title":"\u66F4\u4E3A\u590D\u6742\u7684\u60C5\u5F62","slug":"\u66F4\u4E3A\u590D\u6742\u7684\u60C5\u5F62"}],"relativePath":"node/vm\u6A21\u5757.md"}'),e={name:"node/vm\u6A21\u5757.md"};function t(c,s,r,D,y,C){return o(),a("div",null,s[0]||(s[0]=[l(`<h1 id="nodejs\u4E2D\u7684vm\u6A21\u5757\u8BE6\u89E3" tabindex="-1">NodeJs\u4E2D\u7684vm\u6A21\u5757\u8BE6\u89E3 <a class="header-anchor" href="#nodejs\u4E2D\u7684vm\u6A21\u5757\u8BE6\u89E3" aria-hidden="true">#</a></h1><h2 id="\u4EC0\u4E48\u662Fvm\uFF1F" tabindex="-1">\u4EC0\u4E48\u662Fvm\uFF1F <a class="header-anchor" href="#\u4EC0\u4E48\u662Fvm\uFF1F" aria-hidden="true">#</a></h2><p>VM\u6A21\u5757\u662FNodeJS\u91CC\u9762\u7684\u6838\u5FC3\u6A21\u5757\uFF0C\u652F\u6491\u4E86require\u65B9\u6CD5\u548CNodeJS\u7684\u8FD0\u884C\u673A\u5236\uFF0C\u6211\u4EEC\u6709\u4E9B\u65F6\u5019\u53EF\u80FD\u4E5F\u8981\u7528\u5230VM\u6A21\u677F\u6765\u505A\u4E00\u4E9B\u7279\u6B8A\u7684\u4E8B\u60C5\u3002</p><p>\u901A\u8FC7VM\uFF0CJS\u53EF\u4EE5\u88AB\u7F16\u8BD1\u540E\u7ACB\u5373\u6267\u884C\u6216\u8005\u7F16\u8BD1\u4FDD\u5B58\u4E0B\u6765\u7A0D\u540E\u6267\u884C\uFF08JavaScript code can be compiled and run immediately or compiled, saved, and run later.\uFF09 VM\u6A21\u5757\u5305\u542B\u4E86\u4E09\u4E2A\u5E38\u7528\u7684\u65B9\u6CD5\uFF0C\u7528\u4E8E\u521B\u5EFA\u72EC\u7ACB\u8FD0\u884C\u7684\u6C99\u7BB1\u4F53\u5236\uFF0C\u5982\u4E0B\u4E09\u4E2A\u65B9\u6CD5 vm.runInThisContext(code, filename);</p><p>\u6B64\u65B9\u6CD5\u7528\u4E8E\u521B\u5EFA\u4E00\u4E2A\u72EC\u7ACB\u7684\u6C99\u7BB1\u8FD0\u884C\u7A7A\u95F4\uFF0Ccode\u5185\u7684\u4EE3\u7801\u53EF\u4EE5\u8BBF\u95EE\u5916\u90E8\u7684global\u5BF9\u8C61\uFF0C\u4F46\u662F\u4E0D\u80FD\u8BBF\u95EE\u5176\u4ED6\u53D8\u91CF</p><p>\u800C\u4E14code\u5185\u90E8global\u4E0E\u5916\u90E8\u5171\u4EAB</p><h2 id="runinthiscontext" tabindex="-1">runInThisContext <a class="header-anchor" href="#runinthiscontext" aria-hidden="true">#</a></h2><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> vm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">global</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">vm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">runInThisContext</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">console.log(&#39;ok&#39;, p)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// \u663E\u793Aglobal\u4E0B\u768411</span></span>
<span class="line"><span style="color:#A6ACCD;">vm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">runInThisContext</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">console.log(global)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// \u663E\u793Aglobal</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(p)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// \u663E\u793A5</span></span>
<span class="line"></span></code></pre></div><h2 id="runincontext" tabindex="-1">runInContext <a class="header-anchor" href="#runincontext" aria-hidden="true">#</a></h2><p>\u6B64\u65B9\u6CD5\u7528\u4E8E\u521B\u5EFA\u4E00\u4E2A\u72EC\u7ACB\u7684\u6C99\u7BB1\u8FD0\u884C\u7A7A\u95F4\uFF0CsandBox\u5C06\u505A\u4E3Aglobal\u7684\u53D8\u91CF\u4F20\u5165code\u5185\uFF0C\u4F46\u4E0D\u5B58\u5728global\u53D8\u91CF</p><p>sandBox\u8981\u6C42\u662Fvm.createContext()\u65B9\u6CD5\u521B\u5EFA\u7684sandBox</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> vm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> window </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">vm</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> vm</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">console</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">require</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> require</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">global</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// sandbox \u5FC5\u987B\u7531createContext()\u65B9\u6CD5\u521B\u5EFA\u51FA\u6765\u7684sandBox</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// \u6B64\u5904\u7684window\u4F5C\u4E3Asandbox\uFF0C\u540C\u65F6\u53EA\u80FD\u8BBF\u95EEwindow\u4E0B\u7684\u5C5E\u6027</span></span>
<span class="line"><span style="color:#A6ACCD;">vm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createContext</span><span style="color:#A6ACCD;">(window)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">vm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">runInContext</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p = 3;console.log(typeof global);</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> window)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// global\u662Fundefined</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">p)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// \u88AB\u6539\u53D8\u4E3A3</span></span>
<span class="line"></span></code></pre></div><blockquote><p>vm.runInNewContext()\u65B9\u6CD5\u5E94\u8BE5\u548CrunInContext\u4E00\u6837\uFF0C\u4F46\u662F\u5C11\u4E86\u521B\u5EFAsandBox\u7684\u6B65\u9AA4</p></blockquote><h2 id="\u6BD4\u8F83" tabindex="-1">\u6BD4\u8F83 <a class="header-anchor" href="#\u6BD4\u8F83" aria-hidden="true">#</a></h2><p><img src="`+p+`" alt="node_vm"></p><h2 id="\u66F4\u4E3A\u590D\u6742\u7684\u60C5\u5F62" tabindex="-1">\u66F4\u4E3A\u590D\u6742\u7684\u60C5\u5F62 <a class="header-anchor" href="#\u66F4\u4E3A\u590D\u6742\u7684\u60C5\u5F62" aria-hidden="true">#</a></h2><p>\u5982\u679CrunInContext\u91CC\u9762\u6267\u884CrunInThisContext\u4F1A\u662F\u600E\u4E48\u6837\uFF0CrunInThisContext\u8BBF\u95EE\u5230\u7684global\u5BF9\u8C61\u662F\u8C01\u7684\uFF1F</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> vm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> util </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">util</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> window </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">vm</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> vm</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">console</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">require</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> require</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">global </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">global</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">vm</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">runInNewContext</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p = 3;console.log(typeof global);require(</span><span style="color:#A6ACCD;">\\&#39;</span><span style="color:#C3E88D;">vm</span><span style="color:#A6ACCD;">\\&#39;</span><span style="color:#C3E88D;">).runInThisContext(&quot;console.log(p)&quot;);</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> window)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><blockquote><p>runInThisContext\u91CC\u9762\u7684\u4EE3\u7801\u53EF\u4EE5\u8BBF\u95EE\u5916\u90E8\u7684global\u5BF9\u8C61,\u4F46\u5916\u9762\u5B9E\u9645\u4E0A\u4E0D\u5B58\u5728global\u5BF9\u8C61\uFF08\u867D\u7136\u6709\uFF0C\u4F46\u672C\u8D28\u4E0D\u662Fglobal\u5BF9\u8C61\uFF09,\u53EA\u8981\u8BB0\u4F4F\u4E00\u70B9\uFF0CrunInThisContext\u53EA\u80FD\u8BBF\u95EE\u6700\u9876\u90E8\u7684global\u5BF9\u8C61\u5C31OK\u4E86</p></blockquote><p><strong>\u6267\u884C\u7ED3\u679C\u5982\u4E0B</strong></p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">// object (global\u5B58\u5728\uFF09</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 11 \uFF08\u9876\u90E8global\u7684p)</span></span>
<span class="line"></span></code></pre></div>`,21)]))}var i=n(e,[["render",t]]);export{A as __pageData,i as default};
